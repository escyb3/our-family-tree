<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="docTitle">×¢×œ×•×Ÿ ×”××©×¤×—×”</title>
    <!-- Load Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Heebo font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Heebo', sans-serif;
            background-color: #f3f4f6;
        }
        .ai-result {
            white-space: pre-wrap; /* ×©×•××¨ ×¢×œ ××¢×‘×¨×™ ×©×•×¨×” ××”-API */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="min-h-screen flex flex-col items-center py-12 px-4 sm:px-6 lg:px-8">
        <!-- Main Newsletter Header -->
        <header class="text-center mb-10 w-full max-w-4xl relative">
            <div class="bg-white rounded-3xl shadow-xl p-6 relative">
                <!-- Language Toggle -->
                <button id="lang-toggle" class="absolute top-4 left-4 p-2 bg-indigo-600 text-white rounded-full shadow-lg text-sm font-semibold transition-transform duration-200 hover:scale-105">
                    <span id="lang-text" class="hidden sm:inline-block">Switch to English</span>
                    <span class="sm:hidden">ğŸŒ</span>
                </button>
                
                <h1 id="mainTitle" class="text-5xl font-extrabold text-gray-900 mb-2">×˜×•×¢×Ÿ...</h1>
                <p id="mainSubtitle" class="text-lg text-gray-500">××”×“×•×¨×” ×—×•×“×©×™×ª</p>
            </div>
        </header>

        <main class="w-full max-w-4xl space-y-10">
            <!-- Main Section: Important Update -->
            <section class="bg-white rounded-3xl shadow-2xl overflow-hidden">
                <div class="p-8">
                    <h2 id="websiteTitle" class="text-3xl font-bold text-indigo-700 mb-4 flex items-center">
                        <span class="mr-2">ğŸ‰</span>
                    </h2>
                    <p id="websiteText" class="text-gray-700 leading-relaxed text-lg">
                        <!-- ×ª×•×›×Ÿ ×™×•×›× ×¡ ×œ×›××Ÿ -->
                    </p>
                </div>
            </section>

            <!-- Holiday Section (Dynamic based on date) -->
            <section id="holidaySection" class="bg-indigo-600 rounded-3xl shadow-2xl p-8 text-center text-white transition-all duration-500" style="display: none;">
                <h2 id="holidayTitle" class="text-4xl font-extrabold mb-4 flex items-center justify-center"></h2>
                <p id="holidayText" class="text-xl leading-relaxed font-light"></p>
            </section>
            
            <!-- --- GEMINI AI Feature Section --- -->
            <section class="bg-gray-200 rounded-3xl shadow-2xl p-8 border-4 border-fuchsia-400">
                <h2 id="aiTitle" class="text-3xl font-bold text-fuchsia-700 mb-4 flex items-center border-r-4 border-fuchsia-700 pr-3">
                    <span class="ml-2">âœ¨</span>
                </h2>
                <p id="aiDescription" class="text-gray-700 mb-6 text-lg"></p>

                <button id="generateIdeaBtn" class="w-full px-6 py-3 text-lg font-bold text-white bg-fuchsia-500 rounded-xl shadow-lg hover:bg-fuchsia-600 transition-all duration-300 transform hover:scale-[1.02]">
                    <span id="generateIdeaText">×˜×•×¢×Ÿ...</span>
                </button>
                
                <div id="aiResultContainer" class="mt-6 p-4 bg-white rounded-xl shadow-inner border border-fuchsia-200 hidden">
                    <p id="aiResult" class="ai-result text-gray-800 text-lg mb-2"></p>
                    <div id="aiSources" class="text-xs text-gray-500 mt-3 border-t border-gray-100 pt-2"></div>
                </div>
            </section>
            <!-- --------------------------------- -->

            <!-- In Loving Memory Section -->
            <section class="bg-gray-800 rounded-3xl shadow-2xl overflow-hidden text-center p-8 text-white">
                <h2 id="inMemoryTitle" class="text-3xl font-bold mb-4 flex items-center justify-center border-b border-gray-700 pb-3">
                    <span class="ml-2">ğŸ•¯ï¸</span>
                </h2>
                <p id="inMemoryText1" class="text-gray-300"></p>
                <p id="inMemoryName" class="mt-2 text-2xl font-extrabold text-gray-100"></p>
                <p id="inMemoryDate" class="text-sm text-gray-400"></p>
                <p id="inMemoryText2" class="text-gray-400 mt-4"></p>
            </section>

            <!-- Good News Section -->
            <section class="bg-white rounded-3xl shadow-2xl p-8">
                <h2 id="goodNewsTitle" class="text-3xl font-bold text-teal-600 mb-4 flex items-center border-r-4 border-teal-600 pr-3">
                    <span class="ml-2">ğŸŒŸ</span>
                </h2>
                <p id="goodNewsText" class="text-gray-700 leading-relaxed text-lg">
                </p>
            </section>

            <!-- Recommendations Section -->
            <section class="bg-white rounded-3xl shadow-2xl p-8">
                <h2 id="recommendationsTitle" class="text-3xl font-bold text-orange-600 mb-6 flex items-center border-r-4 border-orange-600 pr-3">
                    <span class="ml-2">ğŸ’¡</span>
                </h2>
                <div class="space-y-4 text-lg">
                    <div id="recommendation1" class="p-3 bg-yellow-50 rounded-lg border border-yellow-200"></div>
                    <div id="recommendation2" class="p-3 bg-yellow-50 rounded-lg border border-yellow-200"></div>
                    <div id="recommendation3" class="p-3 bg-yellow-50 rounded-lg border border-yellow-200"></div>
                </div>
            </section>

            <!-- Family Photos Section -->
            <section class="bg-white rounded-3xl shadow-2xl p-8">
                <h2 id="photosTitle" class="text-3xl font-bold text-pink-600 mb-4 flex items-center border-r-4 border-pink-600 pr-3">
                    <span class="ml-2">ğŸ“¸</span>
                </h2>
                <p id="photosText" class="text-gray-700 mb-6 text-lg"></p>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                    <img src="https://placehold.co/300x300/e9d5ff/8b5cf6?text=×ª××•× ×”+1" alt="×ª××•× ×” ××©×¤×—×ª×™×ª" class="w-full h-auto rounded-xl shadow-md object-cover aspect-square">
                    <img src="https://placehold.co/300x300/fecaca/ef4444?text=×ª××•× ×”+2" alt="×ª××•× ×” ××©×¤×—×ª×™×ª" class="w-full h-auto rounded-xl shadow-md object-cover aspect-square">
                    <img src="https://placehold.co/300x300/dbeafe/3b82f6?text=×ª××•× ×”+3" alt="×ª××•× ×” ××©×¤×—×ª×™×ª" class="w-full h-auto rounded-xl shadow-md object-cover aspect-square">
                    <img src="https://placehold.co/300x300/dcfce7/22c55e?text=×ª××•× ×”+4" alt="×ª××•× ×” ××©×¤×—×ª×™×ª" class="w-full h-auto rounded-xl shadow-md object-cover aspect-square">
                </div>
            </section>

            <!-- Birthdays and Events Section -->
            <section class="bg-white rounded-3xl shadow-2xl p-8">
                <h2 id="eventsTitle" class="text-3xl font-bold text-purple-600 mb-4 flex items-center border-r-4 border-purple-600 pr-3">
                    <span class="ml-2">ğŸ‚</span>
                </h2>
                <ul id="eventsList" class="space-y-3 text-gray-700 text-lg">
                    <!-- Content loaded from static data -->
                </ul>
            </section>
            
            <!-- Contact Section -->
            <section class="bg-white rounded-3xl shadow-2xl p-8 text-center border-t border-gray-100">
                <h2 id="contactTitle" class="text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center">
                    <span class="ml-2">âœï¸</span>
                </h2>
                <p id="contactText" class="text-gray-700 leading-relaxed text-lg">
                </p>
            </section>

            <!-- Footer Section -->
            <footer class="text-center mt-10 text-gray-500">
                <p id="footerText1" class="text-base"></p>
                <p id="footerText2" class="mt-2 text-sm"></p>
            </footer>
        </main>
    </div>

    <!-- Modal for Messages/Errors (replaces alert) -->
    <div id="modalOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 transition-opacity duration-300 items-center justify-center p-4 opacity-0">
        <div id="messageModal" class="bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 transform transition-all duration-300 scale-95" style="display: none;">
            <h3 id="messageTitle" class="text-xl font-bold text-gray-900 mb-4"></h3>
            <p id="messageContent" class="text-gray-700 mb-6"></p>
            <button onclick="hideModal('messageModal')" class="w-full bg-indigo-600 text-white font-semibold py-2 rounded-lg hover:bg-indigo-700 transition duration-150">×¡×’×•×¨</button>
        </div>
    </div>

    <script>
        // --- Gemini API Configuration ---
        const API_KEY = ""; // ××©×ª× ×” ×’×œ×•×‘×œ×™
        const API_MODEL = "gemini-2.5-flash-preview-09-2025";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${API_KEY}`;
        const MAX_RETRIES = 5;

        // ----------------------------------------------------
        // × ×ª×•× ×™× ×¡×˜×˜×™×™× (×‘×¨×™×¨×ª ××—×“×œ) ×•×©×œ×™×˜×” ×‘×©×¤×”
        // ----------------------------------------------------
        
        // × ×ª×•× ×™ ×‘×¨×™×¨×ª ××—×“×œ ×‘×©×ª×™ ×”×©×¤×•×ª
        const defaultContent = {
            'he': {
                'docTitle': '×¢×œ×•×Ÿ ×”××©×¤×—×”',
                'mainTitle': '×¢×œ×•×Ÿ ×”××©×¤×—×”',
                'mainSubtitle': '××”×“×•×¨×” ×—×•×“×©×™×ª - × ×•×‘××‘×¨ 2025',
                'websiteTitle': 'ğŸ‰ ×¤×ª×—× ×• ××ª×¨ ××©×¤×—×ª×™ ×—×“×©!',
                'websiteText': '×× ×—× ×• × ×¨×’×©×™× ×œ×”×›×¨×™×– ×©×”××ª×¨ ×”××©×¤×—×ª×™ ×”×—×“×© ×©×œ× ×• ×›×‘×¨ ×‘××•×•×™×¨! ×”××ª×¨ ×”×•× ××¨×›×– ××—×“ ×œ×›×œ ×”×“×‘×¨×™× ×”××©×¤×—×ª×™×™×: ×’×œ×¨×™×™×ª ×ª××•× ×•×ª, ×œ×•×— ××™×¨×•×¢×™×, ×•×¢×“×›×•× ×™× ×©×•×˜×¤×™×. ×”×™×›× ×¡×• ×œ×‘×§×¨, ×œ×”×ª×¢×“×›×Ÿ ×•×œ×©×ª×£.',
                
                'aiTitle': 'âœ¨ ×¤×™× ×ª ×”×¨×¢×™×•× ×•×ª ×”××©×¤×—×ª×™×™×',
                'aiDescription': '×œ×—×¦×• ×¢×œ ×”×›×¤×ª×•×¨ ×›×“×™ ×œ×§×‘×œ ×¨×¢×™×•×Ÿ ×œ×¤×¢×™×œ×•×ª ××©×¤×—×ª×™×ª ××•××œ×¦×ª, ×›×™×¤×™×ª ×•×¢×“×›× ×™×ª ×œ×¡×•×£ ×”×©×‘×•×¢ ×”×§×¨×•×‘! ×”×¨×¢×™×•×Ÿ × ×•×¦×¨ ×‘×××¦×¢×•×ª ×‘×™× ×” ××œ××›×•×ª×™×ª (Gemini) ×•×›×•×œ×œ ××™×“×¢ ×¨×œ×•×•× ×˜×™ ××”×¨×©×ª.',
                'generateIdeaText': 'âœ¨ ×”×¦×™×¢×• ×œ×™ ×¨×¢×™×•×Ÿ ××©×¤×—×ª×™!',
                'aiLoadingText': '×˜×•×¢×Ÿ ×¨×¢×™×•×Ÿ ×™×¦×™×¨×ª×™...',
                'aiSourcesTitle': '××§×•×¨×•×ª ××™×“×¢ (×—×™×¤×•×© ×’×•×’×œ):',
                
                'inMemoryTitle': 'ğŸ•¯ï¸ ×œ×–×›×¨ ×™×§×™×¨× ×•',
                'inMemoryText1': '×× ×• ×–×•×›×¨×™× ××ª ×›×œ ××œ×” ×©×›×‘×¨ ××™× × ××™×ª× ×•, ×•××•×§×™×¨×™× ××ª ×”×–×™×›×¨×•× ×•×ª ×©×”×©××™×¨×•.',
                'inMemoryName': '×‘××”×‘×”, ×¤×¨× ×§ ×•×Ÿ ×“×¨ ×•×œ×“×” ×–"×œ',
                'inMemoryDate': '× ×¤×˜×¨ ×‘-6 ×‘×™×•×œ×™ 2025, ×‘×§×™×™×¤×˜××•×Ÿ.',
                'inMemoryText2': '×™×”×™ ×–×›×¨×• ×‘×¨×•×š.',
                'goodNewsTitle': 'ğŸŒŸ ×—×“×©×•×ª ×˜×•×‘×•×ª!',
                'goodNewsText': '×¢×“×›×•× ×™× ×˜×•×‘×™× ×™×’×™×¢×• ×‘×§×¨×•×‘! ××—×›×™× ×œ×©××•×¢ ××ª ×”×—×“×©×•×ª ×©×œ×›×.',
                'recommendationsTitle': 'ğŸ’¡ ×¤×™× ×ª ×”×”××œ×¦×•×ª',
                'recommendation1': '<strong class="font-semibold text-gray-900">×¡×¤×¨:</strong> <span class="text-gray-700">×¡×“×¨×ª ×”××¨×™ ×¤×•×˜×¨ - ×¡×“×¨×ª ×”×¡×¤×¨×™× ×”××”×•×‘×” ×¢×œ ×›×œ ×”××©×¤×—×”. ×§×¡× ×•×“××™×•×Ÿ ×‘×›×œ ×¢××•×“!</span>',
                'recommendation2': '<strong class="font-semibold text-gray-900">×¡×¨×˜:</strong> <span class="text-gray-700">×”×§×•×œ ×‘×¨××© (Inside Out) - ×¡×¨×˜ ×× ×™××¦×™×” ×©×œ ×“×™×¡× ×™/×¤×™×§×¡××¨ ×©××¨×’×© ×•××¦×—×™×§ ×’× ×™×œ×“×™× ×•×’× ××‘×•×’×¨×™×.</span>',
                'recommendation3': '<strong class="font-semibold text-gray-900">××§×•× ×œ×‘×§×¨ ×‘×•:</strong> <span class="text-gray-700">×’×Ÿ ×”×—×™×•×ª ×”×ª× "×›×™ ×‘×™×¨×•×©×œ×™× - ×—×•×•×™×” ×œ×™××•×“×™×ª ×•×›×™×¤×™×ª ×œ×›×œ ×”×’×™×œ××™×.</span>',
                'photosTitle': 'ğŸ“¸ ×¨×’×¢×™ ×”×§×™×¥ ×©×œ× ×•',
                'photosText': '×›××” ×ª××•× ×•×ª ×©×¦×•×œ××• ×œ××—×¨×•× ×”, ×›×“×™ ×œ×”×–×›×™×¨ ×œ×›×•×œ× ×• ××ª ×”×¨×’×¢×™× ×”×™×¤×™× ×©×× ×• ×—×•×œ×§×™× ×™×—×“.',
                'eventsTitle': 'ğŸ‚ ×™××™ ×”×•×œ×“×ª ×•××™×¨×•×¢×™× ×§×¨×•×‘×™×',
                'eventsList': `
                    <li class="flex items-center"><span class="ml-2 text-indigo-500">ğŸ‰</span><strong class="font-semibold ml-2">15 ×‘× ×•×‘××‘×¨:</strong> ×™×•× ×”×•×œ×“×ª 12 ×œ×”×œ×œ ×›×¡×¤×™!</li>
                    <li class="flex items-center"><span class="ml-2 text-indigo-500">ğŸ‰</span><strong class="font-semibold ml-2">15 ×‘× ×•×‘××‘×¨:</strong> ×™×•× ×”×•×œ×“×ª 21 ×œ×× ×œ×™×– ×’'×™×Ÿ ×’'×•× ×¡×•×Ÿ!</li>
                    <li class="flex items-center"><span class="ml-2 text-indigo-500">ğŸ’</span><strong class="font-semibold ml-2">15 ×‘× ×•×‘××‘×¨:</strong> ×™×•× × ×™×©×•××™×Ÿ 38 ×œ××œ×Ÿ ×•×‘×× ×™ ××¨×œ×™×Ÿ ×¤×™×©×¨!</li>
                    <li class="flex items-center"><span class="ml-2 text-indigo-500">ğŸ‰</span><strong class="font-semibold ml-2">19 ×‘× ×•×‘××‘×¨:</strong> ×™×•× ×”×•×œ×“×ª 85 ×œ×× ×™×˜×” ×‘×¡×§×™×Ÿ!</li>
                    <li class="flex items-center"><span class="ml-2 text-indigo-500">ğŸ‰</span><strong class="font-semibold ml-2">20 ×‘× ×•×‘××‘×¨:</strong> ×™×•× ×”×•×œ×“×ª 39 ×œ×œ×•×¨×” ×‘×¨×•×§×•×•×™×™ ×¤×¨×’×•×¡×•×Ÿ!</li>
                `,
                'contactTitle': 'âœï¸ ×¨×•×¦×™× ×œ×©×ª×£?',
                'contactText': '×™×© ×œ×›× ×—×“×©×•×ª ××¨×’×©×•×ª, ×”××œ×¦×•×ª ××• ×ª××•× ×•×ª ××”×˜×™×•×œ ×”××©×¤×—×ª×™? ×¤×©×•×˜ ×©×œ×—×• ×œ× ×• ××ª ×”×¢×“×›×•× ×™× ×©×œ×›× ×œ××™×™×œ: <strong>familysite@gmx.com</strong>.',
                'footerText1': '×ª×•×“×” ×©×§×¨××ª×! × ×ª×¨××” ×‘××”×“×•×¨×” ×”×‘××”.',
                'footerText2': '&copy; 2025 ×¢×œ×•×Ÿ ×”××©×¤×—×”. ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª.',
                'buttonText': 'Switch to English',
                'modalTitleSuccess': '×¨×¢×™×•×Ÿ ×—×“×©!',
                'modalTitleError': '×©×’×™××”',
                'modalContentError': '××™×¨×¢×” ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¨×¢×™×•×Ÿ ×”××©×¤×—×ª×™. ×× × × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨.'
            },
            'en': {
                'docTitle': 'The Family Newsletter',
                'mainTitle': 'The Family Newsletter',
                'mainSubtitle': 'Monthly Edition - November 2025',
                'websiteTitle': 'ğŸ‰ New Family Website is Live!',
                'websiteText': 'We are excited to announce that our new family website is now live! The site is a central hub for all things family: a photo gallery, an events calendar, and regular updates. Come visit, get updated, and share!',
                
                'aiTitle': 'âœ¨ Family Idea Corner',
                'aiDescription': 'Click the button to get a fun, recommended, and current family activity idea for the upcoming weekend! The idea is generated using Artificial Intelligence (Gemini) and includes relevant information from the web.',
                'generateIdeaText': 'âœ¨ Suggest a Family Idea!',
                'aiLoadingText': 'Loading creative idea...',
                'aiSourcesTitle': 'Information Sources (Google Search):',
                
                'inMemoryTitle': 'ğŸ•¯ï¸ In Loving Memory',
                'inMemoryText1': 'We remember all those who are no longer with us, and cherish the memories they left behind.',
                'inMemoryName': 'In loving memory of Frank van der Velde z"l',
                'inMemoryDate': 'Died in Cape Town on July 6, 2025.',
                'inMemoryText2': 'May his memory be a blessing.',
                'goodNewsTitle': 'ğŸŒŸ Good News!',
                'goodNewsText': 'Good news coming soon! We are waiting to hear your updates.',
                'recommendationsTitle': 'ğŸ’¡ Recommendations Corner',
                'recommendation1': '<strong class="font-semibold text-gray-900">Book:</strong> <span class="text-gray-700">The Harry Potter series - The beloved book series for the whole family. Magic and imagination on every page!</span>',
                'recommendation2': '<strong class="font-semibold text-gray-900">Movie:</strong> <span class="text-gray-700">Inside Out - A Disney/Pixar animated film that is both touching and funny for kids and adults alike.</span>',
                'recommendation3': '<strong class="font-semibold text-gray-900">Place to Visit:</strong> <span class="text-gray-700">The Biblical Zoo in Jerusalem - A fun and educational experience for all ages.</span>',
                'photosTitle': 'ğŸ“¸ Our Summer Moments',
                'photosText': 'A few recent photos, to remind us all of the beautiful moments we share together.',
                'eventsTitle': 'ğŸ‚ Upcoming Birthdays & Events',
                'eventsList': `
                    <li class="flex items-center"><span class="mr-2 text-indigo-500">ğŸ‰</span><strong class="font-semibold mr-2">November 15:</strong> 12th birthday of Halel Caspi!</li>
                    <li class="flex items-center"><span class="mr-2 text-indigo-500">ğŸ‰</span><strong class="font-semibold mr-2">November 15:</strong> 21st birthday of Analise Jean Johnson!</li>
                    <li class="flex items-center"><span class="mr-2 text-indigo-500">ğŸ’</span><strong class="font-semibold mr-2">November 15:</strong> 38th wedding anniversary of Alan and Bunny Marlene Fisher!</li>
                    <li class="flex items-center"><span class="mr-2 text-indigo-500">ğŸ‰</span><strong class="font-semibold mr-2">November 19:</strong> 85th birthday of Anita Baskin!</li>
                    <li class="flex items-center"><span class="mr-2 text-indigo-500">ğŸ‰</span><strong class="font-semibold mr-2">November 20:</strong> 39th birthday of Laura Brockway Ferguson!</li>
                `,
                'contactTitle': 'âœï¸ Want to Share?',
                'contactText': 'Have exciting news, recommendations, or photos from a family trip? Simply send us your updates to this email: <strong>familysite@gmx.com</strong>.',
                'footerText1': 'Thanks for reading! See you in the next edition.',
                'footerText2': '&copy; 2025 The Family Newsletter. All rights reserved.',
                'buttonText': '×”×—×œ×¤×” ×œ×¢×‘×¨×™×ª',
                'modalTitleSuccess': 'New Idea!',
                'modalTitleError': 'Error',
                'modalContentError': 'An error occurred while loading the family idea. Please try again later.'
            }
        };

        // × ×ª×•× ×™ ×—×’×™× ×¡×˜×˜×™×™×
        const holidays = [
            { id: 'roshHashanah', name: { he: '×¨××© ×”×©× ×”', en: 'Rosh Hashanah' }, message: { he: 'ğŸ ×©× ×” ×˜×•×‘×”!', en: 'ğŸ Happy New Year!' }, detailed_message: { he: '×× ×• ×¨×•×¦×™× ×œ××—×œ ×œ×›×œ ××©×¤×—×ª× ×• ×©× ×” ×˜×•×‘×” ×•××‘×•×¨×›×ª. ×©×ª×”× ×–×• ×©× ×” ×©×œ ×”×ª×—×œ×•×ª ×—×“×©×•×ª, ×‘×¨×™××•×ª, ××•×©×¨ ×•×©×’×©×•×’.', en: 'We want to wish our entire family a good and blessed year. May this be a year of new beginnings, health, happiness, and prosperity.' }, startDate: new Date('2025-09-22T00:00:00'), endDate: new Date('2025-10-04T23:59:59') },
            { id: 'sukkot', name: { he: '×¡×•×›×•×ª', en: 'Sukkot' }, message: { he: 'ğŸŒ¾ ×—×’ ×¡×•×›×•×ª ×©××—!', en: 'ğŸŒ¾ Happy Sukkot!' }, detailed_message: { he: '×—×’ ×¡×•×›×•×ª ×©××— ×œ×›×œ ×”××©×¤×—×”! ×× ×• ×××—×œ×™× ×œ×›× ×©×ª×–×›×• ×œ×©×‘×ª ×‘×¡×•×›×”, ×œ×™×”× ×•×ª ××”××•×•×™×¨ ×”× ×¢×™× ×•××”×–××Ÿ ××™×›×•×ª ××©×•×ª×£. ×—×’ ×©××—!', en: 'Happy Sukkot to the whole family! We wish you to sit in the Sukkah, enjoy the pleasant weather, and quality time together. Happy Holiday!' }, startDate: new Date('2025-10-16T00:00:00'), endDate: new Date('2025-10-25T23:59:59')},
            { id: 'hanukkah', name: { he: '×—× ×•×›×”', en: 'Hanukkah' }, message: { he: 'ğŸ•¯ï¸ ×—× ×•×›×” ×©××—!', en: 'ğŸ•¯ï¸ Happy Hanukkah!' }, detailed_message: { he: '×—×’ ×—× ×•×›×” ×©××— ×•××œ× ×‘××•×¨! ×©×™×”×™×” ×œ×›× ×—×’ ×©×œ × ×™×¡×™×, ×”×“×œ×§×ª × ×¨×•×ª ××©×•×ª×¤×ª, ×¡×•×¤×’× ×™×•×ª ×—××•×ª ×•×–××Ÿ ××™×›×•×ª ××©×¤×—×ª×™.', en: 'Happy and light-filled Hanukkah! May you have a holiday of miracles, shared candle lighting, warm sufganiyot, and quality family time.' }, startDate: new Date('2025-12-15T00:00:00'), endDate: new Date('2025-12-23T23:59:59')},
            { id: 'tishaBAv', name: { he: '×˜×³ ×‘××‘', en: 'Tisha B\'Av' }, message: { he: 'ğŸ˜” ×¦×•× ×§×œ', en: 'ğŸ˜” Easy Fast' }, detailed_message: { he: '×¦×•× ×§×œ ×•×’××¨ ×—×ª×™××” ×˜×•×‘×”. ×™×•× ×–×” ×”×•× ×™×•× ×©×œ ××‘×œ ×¢×œ ×—×•×¨×‘×Ÿ ×‘×™×ª ×”××§×“×©. ×× ×• ×–×•×›×¨×™× ×•××§×•×•×™× ×œ×™××™× ×˜×•×‘×™× ×™×•×ª×¨.', en: 'An easy fast and a good final signing. This day is a day of mourning for the destruction of the Temple. We remember and hope for better days.' }, startDate: new Date('2026-07-23T00:00:00'), endDate: new Date('2026-07-24T23:59:59')} // ×“×•×’××” ×œ×—×’ ×¢×ª×™×“×™
        ];

        let currentLang = 'he'; // ×‘×¨×™×¨×ª ××—×“×œ: ×¢×‘×¨×™×ª
        const now = new Date();
        
        // ××¤×ª×—×™ ×”××œ×× ×˜×™× ×©×œ ×”×××©×§
        const elementsToTranslate = {
            'docTitle': document.getElementById('docTitle'),
            'mainTitle': document.getElementById('mainTitle'),
            'mainSubtitle': document.getElementById('mainSubtitle'),
            'websiteTitle': document.getElementById('websiteTitle'),
            'websiteText': document.getElementById('websiteText'),

            'aiTitle': document.getElementById('aiTitle'),
            'aiDescription': document.getElementById('aiDescription'),
            'generateIdeaText': document.getElementById('generateIdeaText'),

            'inMemoryTitle': document.getElementById('inMemoryTitle'),
            'inMemoryText1': document.getElementById('inMemoryText1'),
            'inMemoryName': document.getElementById('inMemoryName'),
            'inMemoryDate': document.getElementById('inMemoryDate'),
            'inMemoryText2': document.getElementById('inMemoryText2'),
            'goodNewsTitle': document.getElementById('goodNewsTitle'),
            'goodNewsText': document.getElementById('goodNewsText'),
            'recommendationsTitle': document.getElementById('recommendationsTitle'),
            'recommendation1': document.getElementById('recommendation1'),
            'recommendation2': document.getElementById('recommendation2'),
            'recommendation3': document.getElementById('recommendation3'),
            'photosTitle': document.getElementById('photosTitle'),
            'photosText': document.getElementById('photosText'),
            'eventsTitle': document.getElementById('eventsTitle'),
            'eventsList': document.getElementById('eventsList'),
            'contactTitle': document.getElementById('contactTitle'),
            'contactText': document.getElementById('contactText'),
            'footerText1': document.getElementById('footerText1'),
            'footerText2': document.getElementById('footerText2'),
            'lang-text': document.getElementById('lang-text'),
            'holidayTitle': document.getElementById('holidayTitle'),
            'holidayText': document.getElementById('holidayText')
        };

        /**
         * ××¦×™×’ ××•×“×œ (×‘××§×•× alert)
         */
        function showModal(modalId, title, content) {
            document.getElementById('messageTitle').textContent = title;
            document.getElementById('messageContent').textContent = content;
            document.getElementById('modalOverlay').style.display = 'flex';
            document.getElementById('modalOverlay').classList.remove('opacity-0');
            
            const modalElement = document.getElementById(modalId);
            modalElement.style.display = 'block';
            modalElement.classList.add('scale-100');
            modalElement.classList.remove('scale-95');
        }

        /**
         * ××—×‘×™× ××•×“×œ (×‘××§×•× alert)
         */
        function hideModal(modalId) {
            const modalElement = document.getElementById(modalId);
            modalElement.classList.add('scale-95');
            modalElement.classList.remove('scale-100');
            document.getElementById('modalOverlay').classList.add('opacity-0');

            setTimeout(() => {
                modalElement.style.display = 'none';
                document.getElementById('modalOverlay').style.display = 'none';
            }, 300); // Match transition duration
        }


        /**
         * ××¢×“×›× ×ª ××ª ×›×œ ×”×˜×§×¡×˜×™× ×‘×”×ª×× ×œ×©×¤×” ×”× ×•×›×—×™×ª ×•×œ× ×ª×•× ×™× ×”×¡×˜×˜×™×™×.
         */
        function updateLanguage() {
            const langData = defaultContent[currentLang];

            // ×¢×“×›×•×Ÿ ×›×™×•×•× ×™×•×ª ×”×©×¤×”
            document.documentElement.lang = currentLang;
            document.documentElement.dir = currentLang === 'he' ? 'rtl' : 'ltr';

            // ×¢×“×›×•×Ÿ ×›×œ ×”××œ×× ×˜×™× ×‘×ª×•×›×Ÿ
            for (const key in elementsToTranslate) {
                const element = elementsToTranslate[key];
                if (element) {
                    const content = langData[key] || defaultContent[currentLang][key] || defaultContent['he'][key] || defaultContent['en'][key];
                    
                    if (key === 'eventsList' || key.includes('recommendation') || key === 'contactText') {
                        element.innerHTML = content; // ××©×ª××© ×‘-innerHTML ×›×“×™ ×œ×©××•×¨ ×¢×œ ×ª×’×™ HTML ×›××• <strong>
                    } else if (key !== 'lang-text' && key !== 'generateIdeaText') {
                        element.textContent = content; // ××©×ª××© ×‘-textContent ×›×“×™ ×œ×× ×•×¢ ×”×–×¨×§×ª HTML
                    }
                }
            }
            
            // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨ ×”×©×¤×” ×•×›×¤×ª×•×¨ ×”-AI
            elementsToTranslate['lang-text'].textContent = langData.buttonText;
            elementsToTranslate['generateIdeaText'].textContent = langData.generateIdeaText;

            // ×¢×“×›×•×Ÿ ×”×•×“×¢×ª ×”×—×’
            updateHolidaySection();
        }

        /**
         * ×‘×•×“×§×ª ×× ×™×© ×—×’ × ×•×›×—×™ ×•××¦×™×’×” ××ª ×”×”×•×“×¢×” ×”××ª××™××”.
         */
        function updateHolidaySection() {
            const holidaySection = document.getElementById('holidaySection');
            let currentHoliday = null;

            for (const holiday of holidays) {
                if (now >= holiday.startDate && now <= holiday.endDate) {
                    currentHoliday = holiday;
                    break;
                }
            }
            
            if (currentHoliday) {
                holidayTitle.textContent = currentHoliday.message[currentLang];
                holidayText.textContent = currentHoliday.detailed_message[currentLang];
                
                // ×¦×‘×¢×™× ×©×•× ×™× ×œ×™××™ ××‘×œ/×¦×•×
                if (currentHoliday.id === 'tishaBAv') {
                    holidaySection.classList.remove('bg-indigo-600');
                    holidaySection.classList.add('bg-gray-700');
                } else {
                    holidaySection.classList.add('bg-indigo-600');
                    holidaySection.classList.remove('bg-gray-700');
                }
                holidaySection.style.display = 'block';
            } else {
                holidaySection.style.display = 'none';
            }
        }

        /**
         * ××—×œ×™×£ ×‘×™×Ÿ ×¢×‘×¨×™×ª ×œ×× ×’×œ×™×ª
         */
        function toggleLanguage() {
            currentLang = currentLang === 'he' ? 'en' : 'he';
            updateLanguage();
        }

        // ----------------------------------------------------
        // --- Gemini API Logic (Family Idea Generator) ---
        // ----------------------------------------------------

        /**
         * ×§×•×¨××ª ×œ-Gemini API ×›×“×™ ×œ×™×¦×•×¨ ×¨×¢×™×•×Ÿ ×œ×¤×¢×™×œ×•×ª ××©×¤×—×ª×™×ª.
         * ××©×ª××©×ª ×‘-Search Grounding ×œ×§×‘×œ×ª ××™×“×¢ ×¢×“×›× ×™.
         */
        async function fetchGeminiContent(retryCount = 0) {
            const btn = document.getElementById('generateIdeaBtn');
            const resultContainer = document.getElementById('aiResultContainer');
            const resultElement = document.getElementById('aiResult');
            const sourcesElement = document.getElementById('aiSources');
            const originalButtonText = defaultContent[currentLang].generateIdeaText;
            const loadingText = defaultContent[currentLang].aiLoadingText;
            const langCode = currentLang === 'he' ? 'Hebrew' : 'English';


            // Prompt generation
            const systemPrompt = `You are a friendly, enthusiastic, and creative family activity planner. Your goal is to suggest ONE highly specific, fun, and engaging activity idea suitable for a family with mixed ages (kids and adults) for the upcoming weekend. The activity should be fresh and relevant to the current date and local context (general, not location-specific). Provide the response in ${langCode}. Your response must be formatted as a short paragraph or a list of steps.`;
            const userQuery = `Suggest a creative, fun, and up-to-date family activity or trip idea for the coming weekend.`;

            // Prepare UI for loading
            btn.disabled = true;
            btn.textContent = loadingText;
            resultContainer.classList.add('hidden');
            resultElement.textContent = '';
            sourcesElement.innerHTML = '';
            

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;

                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    // Display result
                    resultElement.textContent = text;
                    if (sources.length > 0) {
                        const sourcesTitle = defaultContent[currentLang].aiSourcesTitle;
                        sourcesElement.innerHTML = `<p class="font-semibold mb-1">${sourcesTitle}</p>`;
                        
                        sources.forEach((source, index) => {
                            const link = document.createElement('a');
                            link.href = source.uri;
                            link.target = '_blank';
                            link.textContent = `${source.title} (${source.uri.substring(0, 30)}...)`;
                            link.className = 'block hover:text-indigo-600 transition-colors duration-150';
                            sourcesElement.appendChild(link);
                        });
                    }

                    resultContainer.classList.remove('hidden');

                } else {
                    throw new Error("No generated text found in response.");
                }

            } catch (error) {
                if (retryCount < MAX_RETRIES) {
                    const delay = Math.pow(2, retryCount) * 1000; // Exponential backoff: 1s, 2s, 4s, 8s, 16s
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return fetchGeminiContent(retryCount + 1); // Retry
                } else {
                    console.error("Gemini API Error after retries:", error);
                    showModal('messageModal', defaultContent[currentLang].modalTitleError, defaultContent[currentLang].modalContentError);
                }
            } finally {
                // Reset button state
                btn.disabled = false;
                btn.textContent = originalButtonText;
            }
        }


        // ----------------------------------------------------
        // ×”×¤×¢×œ×ª ×”××¤×œ×™×§×¦×™×” ×œ××—×¨ ×˜×¢×™× ×ª ×”×“×£
        // ----------------------------------------------------
        window.onload = function() {
            // ×˜×¢×™× ×” ×¨××©×•× ×™×ª ×©×œ ×”×ª×•×›×Ÿ
            updateLanguage();

            // ×”×•×¡×¤×ª ×”××–× ×” ×œ×›×¤×ª×•×¨ ×”×©×¤×”
            document.getElementById('lang-toggle').addEventListener('click', toggleLanguage);
            
            // ×”×•×¡×¤×ª ×”××–× ×” ×œ×›×¤×ª×•×¨ ×™×¦×™×¨×ª ×¨×¢×™×•×Ÿ AI
            document.getElementById('generateIdeaBtn').addEventListener('click', fetchGeminiContent);
        };
    </script>

</body>
</html>
