<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×¢×œ×•×Ÿ ×”××©×¤×—×” ×¢× Firestore</title>
  <!-- Load Tailwind CSS from CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Load Heebo font from Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Heebo', sans-serif;
      background-color: #f3f4f6;
    }
    /* ×¡×’× ×•×Ÿ ×œ××¦×‘ ×¢×¨×™×›×” */
    [contenteditable="true"] {
        transition: background-color 0.2s;
        min-height: 1.5em; /* ×œ×× ×™×¢×ª ×”×ª××•×˜×˜×•×ª ××œ×× ×˜×™× ×¨×™×§×™× */
    }
    [contenteditable="true"]:focus {
        background-color: #fef9e7; /* ×¨×§×¢ ×¦×”×‘×”×‘ ×§×œ ×‘×¢×ª ×¢×¨×™×›×” */
        outline: 2px dashed #ff9800; /* ×”×“×’×©×” ×©×œ ×”××¡×’×¨×ª */
        outline-offset: 4px;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="min-h-screen flex flex-col items-center py-12 px-4 sm:px-6 lg:px-8">
    <!-- Main Newsletter Header -->
    <header class="text-center mb-10 w-full max-w-4xl relative">
      <div class="bg-white rounded-3xl shadow-xl p-6 relative">
        <!-- Language Toggle -->
        <button id="lang-toggle" class="absolute top-4 left-4 p-2 bg-indigo-500 text-white rounded-full shadow-md text-sm transition-transform duration-200 hover:scale-105">
            <span id="lang-text" class="hidden sm:inline-block">Switch to English</span>
            <span class="sm:hidden">ğŸŒ</span>
        </button>
        
        <!-- Admin/Logout Button (Dynamic) -->
        <button id="adminToggleBtn" class="absolute top-4 right-4 p-2 rounded-full shadow-md text-sm transition-all duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300" title="×›× ×™×¡×ª ×× ×”×œ">
            <span id="adminButtonText">×›× ×™×¡×ª ×× ×”×œ âš™ï¸</span>
        </button>
        
        <h1 id="mainTitle" class="text-5xl font-bold text-gray-900 mb-2">×˜×•×¢×Ÿ...</h1>
        <p id="mainSubtitle" class="text-lg text-gray-500">×˜×•×¢×Ÿ × ×ª×•× ×™× ×××¡×“ ×”× ×ª×•× ×™×</p>
        <!-- Admin Mode Indicator (Hidden by default) -->
        <span id="adminIndicator" class="hidden absolute bottom-0 left-1/2 transform -translate-x-1/2 bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg">××¦×‘ ×× ×”×œ ×¤×¢×™×œ: × ×™×ª×Ÿ ×œ×¢×¨×•×š!</span>
        <span id="loadingStatus" class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 text-sm text-gray-500"></span>
      </div>
    </header>

    <main class="w-full max-w-4xl space-y-8">
      <!-- Main Section: Important Update -->
      <section class="bg-white rounded-3xl shadow-xl overflow-hidden">
        <div class="p-6">
          <h2 id="websiteTitle" class="text-3xl font-bold text-indigo-600 mb-4 flex items-center">
            <span class="mr-2">ğŸ‰</span>
          </h2>
          <p id="websiteText" class="text-gray-700 leading-relaxed">
            
          </p>
        </div>
      </section>

      <!-- Holiday Section (Dynamic) -->
      <section id="holidaySection" class="bg-indigo-500 rounded-3xl shadow-xl p-6 text-center text-white" style="display: none;">
        <h2 id="holidayTitle" class="text-3xl font-bold mb-4 flex items-center justify-center"></h2>
        <p id="holidayText" class="text-lg leading-relaxed"></p>
      </section>

      <!-- In Loving Memory Section -->
      <section class="bg-gray-800 rounded-3xl shadow-xl overflow-hidden text-center p-6 text-white">
        <h2 id="inMemoryTitle" class="text-3xl font-bold mb-4 flex items-center justify-center">
          <span class="ml-2">ğŸ•¯ï¸</span> 
        </h2>
        <p id="inMemoryText1" class="text-gray-300"></p>
        <p id="inMemoryName" class="mt-2 text-xl font-semibold text-gray-200"></p>
        <p id="inMemoryDate" class="text-sm text-gray-400"></p>
        <p id="inMemoryText2" class="text-gray-400 mt-4"></p>
      </section>

      <!-- Good News Section -->
      <section class="bg-white rounded-3xl shadow-xl p-6">
        <h2 id="goodNewsTitle" class="text-3xl font-bold text-teal-600 mb-4 flex items-center">
          <span class="ml-2">ğŸŒŸ</span> 
        </h2>
        <p id="goodNewsText" class="text-gray-700 leading-relaxed">
        </p>
      </section>

      <!-- Recommendations Section -->
      <section class="bg-white rounded-3xl shadow-xl p-6">
        <h2 id="recommendationsTitle" class="text-3xl font-bold text-orange-600 mb-4 flex items-center">
          <span class="ml-2">ğŸ’¡</span> 
        </h2>
        <div class="space-y-4">
          <div id="recommendation1"></div>
          <div id="recommendation2"></div>
          <div id="recommendation3"></div>
        </div>
      </section>

      <!-- Family Photos Section -->
      <section class="bg-white rounded-3xl shadow-xl p-6">
        <h2 id="photosTitle" class="text-3xl font-bold text-pink-600 mb-4 flex items-center">
          <span class="ml-2">ğŸ“¸</span> 
        </h2>
        <p id="photosText" class="text-gray-700 mb-6"></p>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
          <img src="https://placehold.co/300x300/e9d5ff/8b5cf6?text=×ª××•× ×”+1" alt="×ª××•× ×” ××©×¤×—×ª×™×ª" class="w-full h-auto rounded-lg shadow-md">
          <img src="https://placehold.co/300x300/fecaca/ef4444?text=×ª××•× ×”+2" alt="×ª××•× ×” ××©×¤×—×ª×™×ª" class="w-full h-auto rounded-lg shadow-md">
          <img src="https://placehold.co/300x300/dbeafe/3b82f6?text=×ª××•× ×”+3" alt="×ª××•× ×” ××©×¤×—×ª×™×ª" class="w-full h-auto rounded-lg shadow-md">
          <img src="https://placehold.co/300x300/dcfce7/22c55e?text=×ª××•× ×”+4" alt="×ª××•× ×” ××©×¤×—×ª×™×ª" class="w-full h-auto rounded-lg shadow-md">
        </div>
      </section>

      <!-- Birthdays and Events Section -->
      <section class="bg-white rounded-3xl shadow-xl p-6">
        <h2 id="eventsTitle" class="text-3xl font-bold text-purple-600 mb-4 flex items-center">
          <span class="ml-2">ğŸ‚</span> 
        </h2>
        <ul id="eventsList" class="space-y-3 text-gray-700">
          <!-- Content loaded from Firestore/Default -->
        </ul>
      </section>
      
      <!-- Contact Section -->
      <section class="bg-white rounded-3xl shadow-xl p-6 text-center">
        <h2 id="contactTitle" class="text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center">
          <span class="ml-2">âœï¸</span> 
        </h2>
        <p id="contactText" class="text-gray-700 leading-relaxed">
        </p>
      </section>

      <!-- Footer Section -->
      <footer class="text-center mt-10 text-gray-500">
        <p id="footerText1"></p>
        <p id="footerText2" class="mt-2 text-sm"></p>
        <p id="userIdDisplay" class="mt-4 text-xs text-gray-400"></p>
      </footer>
    </main>
  </div>

  <!-- Modal Overlay -->
  <div id="modalOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 transition-opacity duration-300 items-center justify-center p-4">
    
    <!-- Password Prompt Modal -->
    <div id="passwordModal" class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 transform transition-transform duration-300 scale-95" role="dialog" aria-modal="true" aria-labelledby="modalTitle" style="display: none;">
      <h3 id="modalTitle" class="text-xl font-bold text-gray-800 mb-4 text-right">×›× ×™×¡×ª ×× ×”×œ×™×</h3>
      <p class="text-gray-600 mb-4 text-right">×”×›× ×¡ ×¡×™×¡××” ×œ×¢×¨×™×›×ª ×”×¢×œ×•×Ÿ:</p>
      <input type="password" id="adminPasswordInput" class="w-full p-3 mb-4 border border-gray-300 rounded-lg text-right focus:ring-indigo-500 focus:border-indigo-500" placeholder="×”×§×œ×“ ×¡×™×¡××” ×›××Ÿ">
      <div class="flex justify-between space-x-2">
        <button id="submitPasswordBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-xl transition-colors duration-200 flex-1">×›× ×™×¡×”</button>
        <button id="closePasswordModalBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-xl transition-colors duration-200">×‘×™×˜×•×œ</button>
      </div>
    </div>

    <!-- Message Modal (for errors/success) -->
    <div id="messageModal" class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 transform transition-transform duration-300 scale-95" role="alert" aria-live="assertive" style="display: none;">
      <h3 id="messageTitle" class="text-xl font-bold text-gray-800 mb-4 text-right">×”×•×“×¢×”</h3>
      <p id="messageContent" class="text-gray-600 mb-4 text-right"></p>
      <button id="closeMessageModalBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-xl transition-colors duration-200 w-full">×¡×’×•×¨</button>
    </div>

  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    // ----------------------------------------------------
    // 1. ×”×’×“×¨×•×ª ×•×™×™×‘×•× ×¡×¤×¨×™×•×ª Firebase
    // ----------------------------------------------------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, onSnapshot, setDoc, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    
    // ×”×’×“×¨×ª ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× × ×“×¨×©×™× ××”×¡×‘×™×‘×”
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    
    // ×§×•× ×¤×™×’×•×¨×¦×™×™×ª Firebase (×©×™××•×© ×‘×§×•× ×¤×™×’×•×¨×¦×™×” ×”×¡×‘×™×‘×ª×™×ª ××• ×‘×§×•× ×¤×™×’×•×¨×¦×™×” ×©×¡×•×¤×§×” ×›-fallback)
    const fallbackConfig = {
        apiKey: "AIzaSyBvWl8wHsBX3HkAeIToQd5S4sPIeav0ahQ",
        authDomain: "newslatter-1c248.firebaseapp.com",
        projectId: "newslatter-1c248",
        storageBucket: "newslatter-1c248.firebasestorage.app",
        messagingSenderId: "809234374222",
        appId: "1:809234374222:web:7fccaea62d23eaab60ed1f",
        measurementId: "G-PZEBM6WG8Z"
    };
    const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' && __firebase_config ? __firebase_config : JSON.stringify(fallbackConfig));
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

    // ×”×’×“×¨×ª ××©×ª× ×™ Firebase ×’×œ×•×‘×œ×™×™×
    let db = null;
    let auth = null;
    let isAuthReady = false;
    let userId = null;
    let isFirestoreReady = false;
    let unsubscribe = null; // for the snapshot listener
    
    // ×”×’×“×¨×ª ×¨××ª ×œ×•×’×™× ×œ×¦×•×¨×š ×“×™×‘××’
    setLogLevel('debug');

    // ----------------------------------------------------
    // 2. × ×ª×•× ×™ ×‘×¨×™×¨×ª ××—×“×œ ×•× ×ª×•× ×™× ×—×™×™×
    // ----------------------------------------------------
    
    // × ×ª×•× ×™ ×‘×¨×™×¨×ª ××—×“×œ ×× ××™×Ÿ × ×ª×•× ×™× ×‘-Firestore
    const defaultContent = {
      'he': {
        'mainTitle': '×¢×œ×•×Ÿ ×”××©×¤×—×”',
        'mainSubtitle': '××”×“×•×¨×” ×—×•×“×©×™×ª - × ×•×‘××‘×¨ 2025',
        'websiteTitle': 'ğŸ‰ ×¤×ª×—× ×• ××ª×¨ ××©×¤×—×ª×™ ×—×“×©!',
        'websiteText': '×× ×—× ×• × ×¨×’×©×™× ×œ×”×›×¨×™×– ×©×”××ª×¨ ×”××©×¤×—×ª×™ ×”×—×“×© ×©×œ× ×• ×›×‘×¨ ×‘××•×•×™×¨! ×”××ª×¨ ×”×•× ××¨×›×– ××—×“ ×œ×›×œ ×”×“×‘×¨×™× ×”××©×¤×—×ª×™×™×: ×’×œ×¨×™×™×ª ×ª××•× ×•×ª, ×œ×•×— ××™×¨×•×¢×™×, ×¦\'××˜ AI ××©×¤×—×ª×™ ×©×™×¢×–×•×¨ ×œ×›× ×œ×¤×ª×•×¨ ×›×œ ×‘×¢×™×” ××©×¤×—×ª×™×ª (×˜×•×‘, ×›××¢×˜), ×•×¢×•×“. ×”×™×›× ×¡×• ×œ×‘×§×¨, ×œ×”×ª×¢×“×›×Ÿ ×•×œ×©×ª×£.',
        'inMemoryTitle': 'ğŸ•¯ï¸ ×œ×–×›×¨ ×™×§×™×¨× ×•',
        'inMemoryText1': '×× ×• ×–×•×›×¨×™× ××ª ×›×œ ××œ×” ×©×›×‘×¨ ××™× × ××™×ª× ×•, ×•××•×§×™×¨×™× ××ª ×”×–×™×›×¨×•× ×•×ª ×©×”×©××™×¨×•.',
        'inMemoryName': '×‘××”×‘×”, ×¤×¨× ×§ ×•×Ÿ ×“×¨ ×•×œ×“×” ×–"×œ',
        'inMemoryDate': '× ×¤×˜×¨ ×‘-6 ×‘×™×•×œ×™ 2025, ×‘×§×™×™×¤×˜××•×Ÿ.',
        'inMemoryText2': '×™×”×™ ×–×›×¨×• ×‘×¨×•×š.',
        'goodNewsTitle': 'ğŸŒŸ ×—×“×©×•×ª ×˜×•×‘×•×ª!',
        'goodNewsText': '×¢×“×›×•× ×™× ×˜×•×‘×™× ×™×’×™×¢×• ×‘×§×¨×•×‘! ××—×›×™× ×œ×©××•×¢ ××ª ×”×—×“×©×•×ª ×©×œ×›×.',
        'recommendationsTitle': 'ğŸ’¡ ×¤×™× ×ª ×”×”××œ×¦×•×ª',
        'recommendation1': '<strong class="font-semibold text-gray-900">×¡×¤×¨:</strong> <span class="text-gray-700">×¡×“×¨×ª ×”××¨×™ ×¤×•×˜×¨ - ×¡×“×¨×ª ×”×¡×¤×¨×™× ×”××”×•×‘×” ×¢×œ ×›×œ ×”××©×¤×—×”. ×§×¡× ×•×“××™×•×Ÿ ×‘×›×œ ×¢××•×“!</span>',
        'recommendation2': '<strong class="font-semibold text-gray-900">×¡×¨×˜:</strong> <span class="text-700">×”×§×•×œ ×‘×¨××© (Inside Out) - ×¡×¨×˜ ×× ×™××¦×™×” ×©×œ ×“×™×¡× ×™/×¤×™×§×¡××¨ ×©××¨×’×© ×•××¦×—×™×§ ×’× ×™×œ×“×™× ×•×’× ××‘×•×’×¨×™×.</span>',
        'recommendation3': '<strong class="font-semibold text-gray-900">××§×•× ×œ×‘×§×¨ ×‘×•:</strong> <span class="text-gray-700">×’×Ÿ ×”×—×™×•×ª ×”×ª× "×›×™ ×‘×™×¨×•×©×œ×™× - ×—×•×•×™×” ×œ×™××•×“×™×ª ×•×›×™×¤×™×ª ×œ×›×œ ×”×’×™×œ××™×.</span>',
        'photosTitle': 'ğŸ“¸ ×¨×’×¢×™ ×”×§×™×¥ ×©×œ× ×•',
        'photosText': '×›××” ×ª××•× ×•×ª ×©×¦×•×œ××• ×œ××—×¨×•× ×”, ×›×“×™ ×œ×”×–×›×™×¨ ×œ×›×•×œ× ×• ××ª ×”×¨×’×¢×™× ×”×™×¤×™× ×©×× ×• ×—×•×œ×§×™× ×™×—×“.',
        'eventsTitle': 'ğŸ‚ ×™××™ ×”×•×œ×“×ª ×•××™×¨×•×¢×™× ×§×¨×•×‘×™×',
        'eventsList': `
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">15 ×‘× ×•×‘××‘×¨:</strong> ×™×•× ×”×•×œ×“×ª 12 ×œ×”×œ×œ ×›×¡×¤×™!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">15 ×‘× ×•×‘××‘×¨:</strong> ×™×•× ×”×•×œ×“×ª 21 ×œ×× ×œ×™×– ×’'×™×Ÿ ×’'×•× ×¡×•×Ÿ!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ’</span><strong class="font-semibold">15 ×‘× ×•×‘××‘×¨:</strong> ×™×•× × ×™×©×•××™×Ÿ 38 ×œ××œ×Ÿ ×•×‘×× ×™ ××¨×œ×™×Ÿ ×¤×™×©×¨!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">19 ×‘× ×•×‘××‘×¨:</strong> ×™×•× ×”×•×œ×“×ª 85 ×œ×× ×™×˜×” ×‘×¡×§×™×Ÿ!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">20 ×‘× ×•×‘××‘×¨:</strong> ×™×•× ×”×•×œ×“×ª 39 ×œ×œ×•×¨×” ×‘×¨×•×§×•×•×™×™ ×¤×¨×’×•×¡×•×Ÿ!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">21 ×‘× ×•×‘××‘×¨:</strong> ×™×•× ×”×•×œ×“×ª 61 ×œ×¤×•×œ ×’×•×œ×“××Ÿ!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">21 ×‘× ×•×‘××‘×¨:</strong> ×™×•× ×”×•×œ×“×ª 76 ×œ×‘××˜ ×–×•××¨!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">22 ×‘× ×•×‘××‘×¨:</strong> ×™×•× ×”×•×œ×“×ª 46 ×œ××‘×™ ×’×¨×•×¡××Ÿ!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">22 ×‘× ×•×‘××‘×¨:</strong> ×™×•× ×”×•×œ×“×ª 9 ×œ×¦'××¨×œ×™ × ×’×œ×‘×œ×˜!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">22 ×‘× ×•×‘××‘×¨:</strong> ×™×•× ×”×•×œ×“×ª 4 ×œ×™×¦×—×§ ×××™×¨ × ×’×œ×‘×œ×˜!</li>
        `,
        'contactTitle': 'âœï¸ ×¨×•×¦×™× ×œ×©×ª×£?',
        'contactText': '×™×© ×œ×›× ×—×“×©×•×ª ××¨×’×©×•×ª, ×”××œ×¦×•×ª ××• ×ª××•× ×•×ª ××”×˜×™×•×œ ×”××©×¤×—×ª×™? ×¤×©×•×˜ ×©×œ×—×• ×œ× ×• ××ª ×”×¢×“×›×•× ×™× ×©×œ×›× ×œ××™×™×œ: <strong>familysite@gmx.com</strong>.',
        'footerText1': '×ª×•×“×” ×©×§×¨××ª×! × ×ª×¨××” ×‘××”×“×•×¨×” ×”×‘××”.',
        'footerText2': '&copy; 2025 ×¢×œ×•×Ÿ ×”××©×¤×—×”. ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª.',
        'buttonText': 'Switch to English',
        'adminLoginText': '×›× ×™×¡×ª ×× ×”×œ âš™ï¸',
        'adminLogoutText': '×™×¦×™××” ××× ×”×œ ğŸ”“',
        'adminIndicator': '××¦×‘ ×× ×”×œ ×¤×¢×™×œ: × ×™×ª×Ÿ ×œ×¢×¨×•×š! (× ×©××¨ ×‘-DB)',
        'loginSuccess': '× ×›× ×¡×ª ×œ××¦×‘ ×× ×”×œ. × ×™×ª×Ÿ ×œ×¢×¨×•×š ××ª ×”×ª×•×›×Ÿ ×™×©×™×¨×•×ª. ×©×™××• ×œ×‘: ×”×¢×¨×™×›×•×ª × ×©××¨×•×ª ×‘××•×¤×Ÿ ××™×™×“×™ ×‘-Firestore.',
        'loginError': '×”×¡×™×¡××” ×©×”×•×–× ×” ×©×’×•×™×”. × ×¡×” ×©×•×‘.',
        'logoutSuccess': '×™×¦××ª ×××¦×‘ ×× ×”×œ ×‘×”×¦×œ×—×”.',
        'savingStatus': '×©×•××¨...',
        'savedStatus': '× ×©××¨',
        'loadingStatus': '×˜×•×¢×Ÿ × ×ª×•× ×™×...',
        'loadedStatus': '×”×¢×œ×•×Ÿ ×˜×¢×•×Ÿ.'
      },
      'en': {
        'mainTitle': 'The Family Newsletter',
        'mainSubtitle': 'Monthly Edition - November 2025',
        'websiteTitle': 'ğŸ‰ New Family Website is Live!',
        'websiteText': 'We are excited to announce that our new family website is now live! The site is a central hub for all things family: a photo gallery, an events calendar, a family AI chat to help with any family issue (well, almost), and more. Come visit, get updated, and share!',
        'inMemoryTitle': 'ğŸ•¯ï¸ In Loving Memory',
        'inMemoryText1': 'We remember all those who are no longer with us, and cherish the memories they left behind.',
        'inMemoryName': 'In loving memory of Frank van der Velde z"l',
        'inMemoryDate': 'Died in Cape Town on July 6, 2025.',
        'inMemoryText2': 'May his memory be a blessing.',
        'goodNewsTitle': 'ğŸŒŸ Good News!',
        'goodNewsText': 'Good news coming soon! We are waiting to hear your updates.',
        'recommendationsTitle': 'ğŸ’¡ Recommendations Corner',
        'recommendation1': '<strong class="font-semibold text-gray-900">Book:</strong> <span class="text-gray-700">The Harry Potter series - The beloved book series for the whole family. Magic and imagination on every page!</span>',
        'recommendation2': '<strong class="font-semibold text-gray-900">Movie:</strong> <span class="text-700">Inside Out - A Disney/Pixar animated film that is both touching and funny for kids and adults alike.</span>',
        'recommendation3': '<strong class="font-semibold text-gray-900">Place to Visit:</strong> <span class="text-gray-700">The Biblical Zoo in Jerusalem - A fun and educational experience for all ages.</span>',
        'photosTitle': 'ğŸ“¸ Our Summer Moments',
        'photosText': 'A few recent photos, to remind us all of the beautiful moments we share together.',
        'eventsTitle': 'ğŸ‚ Upcoming Birthdays & Events',
        'eventsList': `
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">November 15:</strong> 12th birthday of Halel Caspi!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">November 15:</strong> 21st birthday of Analise Jean Johnson!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ’</span><strong class="font-semibold">November 15:</strong> 38th wedding anniversary of Alan and Bunny Marlene Fisher!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">November 19:</strong> 85th birthday of Anita Baskin!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">November 20:</strong> 39th birthday of Laura Brockway Ferguson!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">November 21:</strong> 61st birthday of Paul Goldman!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">November 21:</strong> 76th birthday of Beth Sommer!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">November 22:</strong> 46th birthday of Avi Grossman!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">November 22:</strong> 9th birthday of Charlie Nagelblatt!</li>
            <li class="flex items-center"><span class="ml-2">ğŸ‰</span><strong class="font-semibold">November 22:</strong> 4th birthday of Yitzchok Meir Nagelblatt!</li>
        `,
        'contactTitle': 'âœï¸ Want to Share?',
        'contactText': 'Have exciting news, recommendations, or photos from a family trip? Simply send us your updates to this email: <strong>familysite@gmx.com</strong>.',
        'footerText1': 'Thanks for reading! See you in the next edition.',
        'footerText2': '&copy; 2025 The Family Newsletter. All rights reserved.',
        'buttonText': '×”×—×œ×¤×” ×œ×¢×‘×¨×™×ª',
        'adminLoginText': 'Admin Login âš™ï¸',
        'adminLogoutText': 'Exit Admin Mode ğŸ”“',
        'adminIndicator': 'Admin Mode Active: Editable! (Saved to DB)',
        'loginSuccess': 'Login Successful. Content is now editable and changes are saved immediately to Firestore.',
        'loginError': 'Incorrect password. Please try again.',
        'logoutSuccess': 'Exited Admin Mode successfully.',
        'savingStatus': 'Saving...',
        'savedStatus': 'Saved',
        'loadingStatus': 'Loading data...',
        'loadedStatus': 'Newsletter loaded.'
      }
    };
    
    // ×”× ×ª×•× ×™× ×”×—×™×™× ×©×™×˜×¢× ×• ×-Firestore
    let newsletterData = JSON.parse(JSON.stringify(defaultContent));
    
    // ----------------------------------------------------
    // 3. ×œ×•×’×™×§×ª ×”××¤×œ×™×§×¦×™×” ×•×©×œ×™×˜×” ×‘×××©×§ ×”××©×ª××©
    // ----------------------------------------------------
    
    // ×”×’×“×¨×•×ª ×›×œ×œ×™×•×ª
    const ADMIN_PASSWORD = 'admin2025';
    let currentLang = 'he';
    let isAdminMode = false;
    const now = new Date();
    
    // ××¤×ª×—×™ ×”××œ×× ×˜×™× ×©×œ ×”×××©×§
    const elementsToTranslate = {
      'mainTitle': document.getElementById('mainTitle'),
      'mainSubtitle': document.getElementById('mainSubtitle'),
      'websiteTitle': document.getElementById('websiteTitle'),
      'websiteText': document.getElementById('websiteText'),
      'inMemoryTitle': document.getElementById('inMemoryTitle'),
      'inMemoryText1': document.getElementById('inMemoryText1'),
      'inMemoryName': document.getElementById('inMemoryName'),
      'inMemoryDate': document.getElementById('inMemoryDate'),
      'inMemoryText2': document.getElementById('inMemoryText2'),
      'goodNewsTitle': document.getElementById('goodNewsTitle'),
      'goodNewsText': document.getElementById('goodNewsText'),
      'recommendationsTitle': document.getElementById('recommendationsTitle'),
      'recommendation1': document.getElementById('recommendation1'),
      'recommendation2': document.getElementById('recommendation2'),
      'recommendation3': document.getElementById('recommendation3'),
      'photosTitle': document.getElementById('photosTitle'),
      'photosText': document.getElementById('photosText'),
      'eventsTitle': document.getElementById('eventsTitle'),
      'eventsList': document.getElementById('eventsList'),
      'contactTitle': document.getElementById('contactTitle'),
      'contactText': document.getElementById('contactText'),
      'footerText1': document.getElementById('footerText1'),
      'footerText2': document.getElementById('footerText2'),
      'lang-text': document.getElementById('lang-text'),
      'holidayTitle': document.getElementById('holidayTitle'),
      'holidayText': document.getElementById('holidayText')
    };

    const adminIndicator = document.getElementById('adminIndicator');
    const loadingStatus = document.getElementById('loadingStatus');
    const adminToggleBtn = document.getElementById('adminToggleBtn');
    const adminButtonText = document.getElementById('adminButtonText');


    // × ×ª×•× ×™ ×—×’×™× (×§×•×“××™× ××”×‘×§×©×” ×”×§×•×“××ª)
    const holidays = [
      { id: 'roshHashanah', name: { he: '×¨××© ×”×©× ×”', en: 'Rosh Hashanah' }, message: { he: 'ğŸ ×©× ×” ×˜×•×‘×”!', en: 'ğŸ Happy New Year!' }, detailed_message: { he: '×× ×• ×¨×•×¦×™× ×œ××—×œ ×œ×›×œ ××©×¤×—×ª× ×• ×©× ×” ×˜×•×‘×” ×•××‘×•×¨×›×ª. ×©×ª×”× ×–×• ×©× ×” ×©×œ ×”×ª×—×œ×•×ª ×—×“×©×•×ª, ×‘×¨×™××•×ª, ××•×©×¨ ×•×©×’×©×•×’. ××™ ×™×™×ª×Ÿ ×•×›×œ ××©××œ×•×ª×™× ×• ×”×˜×•×‘×•×ª ×™×ª×’×©××•.', en: 'We want to wish our entire family a good and blessed year. May this be a year of new beginnings, health, happiness, and prosperity. May all our good wishes come true.' }, startDate: new Date('2025-09-22T00:00:00'), endDate: new Date('2025-10-04T23:59:59') },
      { id: 'sukkot', name: { he: '×¡×•×›×•×ª', en: 'Sukkot' }, message: { he: 'ğŸŒ¾ ×—×’ ×¡×•×›×•×ª ×©××—!', en: 'ğŸŒ¾ Happy Sukkot!' }, detailed_message: { he: '×—×’ ×¡×•×›×•×ª ×©××— ×œ×›×œ ×”××©×¤×—×”! ×× ×• ×××—×œ×™× ×œ×›× ×©×ª×–×›×• ×œ×©×‘×ª ×‘×¡×•×›×”, ×œ×™×”× ×•×ª ××”××•×•×™×¨ ×”× ×¢×™× ×•××”×–××Ÿ ××™×›×•×ª ××©×•×ª×£. ××™ ×™×™×ª×Ÿ ×•×›×œ ××©××œ×•×ª×™×›× ×™×ª×’×©××•. ×—×’ ×©××—!', en: 'Happy Sukkot to the whole family! We wish you to sit in the Sukkah, enjoy the pleasant weather, and quality time together. May all your wishes come true. Happy Holiday!' }, startDate: new Date('2025-10-16T00:00:00'), endDate: new Date('2025-10-25T23:59:59')},
      { id: 'hanukkah', name: { he: '×—× ×•×›×”', en: 'Hanukkah' }, message: { he: 'ğŸ•¯ï¸ ×—× ×•×›×” ×©××—!', en: 'ğŸ•¯ï¸ Happy Hanukkah!' }, detailed_message: { he: '×—×’ ×—× ×•×›×” ×©××— ×•××œ× ×‘××•×¨! ×©×™×”×™×” ×œ×›× ×—×’ ×©×œ × ×™×¡×™×, ×”×“×œ×§×ª × ×¨×•×ª ××©×•×ª×¤×ª, ×¡×•×¤×’× ×™×•×ª ×—××•×ª ×•×–××Ÿ ××™×›×•×ª ××©×¤×—×ª×™. ××™ ×™×™×ª×Ÿ ×•×”××•×¨ ×™××™×¨ ××ª ×“×¨×›×›× ×ª××™×“.', en: 'Happy and light-filled Hanukkah! May you have a holiday of miracles, shared candle lighting, warm sufganiyot, and quality family time. May the light always shine on your path.' }, startDate: new Date('2025-12-15T00:00:00'), endDate: new Date('2025-12-23T23:59:59')},
      { id: 'tuBishvat', name: { he: '×˜"×• ×‘×©×‘×˜', en: 'Tu B\'Shvat' }, message: { he: 'ğŸŒ³ ×˜"×• ×‘×©×‘×˜ ×©××—!', en: 'ğŸŒ³ Happy Tu B\'Shvat!' }, detailed_message: { he: '×—×’ ×˜"×• ×‘×©×‘×˜ ×©××— ×œ×›×œ ×”××©×¤×—×”! ×–×”×• ×¨××© ×”×©× ×” ×œ××™×œ× ×•×ª, ×–××Ÿ ×œ×–×›×•×¨ ××ª ×—×©×™×‘×•×ª ×”×˜×‘×¢ ×•×”×¦××™×—×”. ×× ×• ×××—×œ×™× ×œ×›× ×©×ª×”×™×” ×œ×›× ×©× ×” ×©×œ ×¤×¨×™×—×” ×•×”×’×©××”, ×•×©× ××©×™×š ×œ×©×ª×•×œ ×–×¨×¢×™× ×©×œ ××”×‘×” ×•×ª×§×•×•×” ×‘×¢×•×œ×× ×•.', en: 'Happy Tu B\'Shvat to the whole family! It\'s the New Year for trees, a time to remember the importance of nature and growth. We wish you a year of blooming and fulfillment, and that we continue to plant seeds of love and hope in our world.' }, startDate: new Date('2026-02-02T00:00:00'), endDate: new Date('2026-02-03T23:59:59') },
      { id: 'purim', name: { he: '×¤×•×¨×™×', en: 'Purim' }, message: { he: 'ğŸ­ ×—×’ ×¤×•×¨×™× ×©××—!', en: 'ğŸ­ Happy Purim!' }, detailed_message: { he: '×¤×•×¨×™× ×©××— ×œ×›×œ ×”××©×¤×—×”! ×©×™×”×™×” ×œ×›× ×—×’ ××œ× ×‘×©××—×”, ×ª×—×¤×•×©×•×ª ×™×¦×™×¨×ª×™×•×ª, ××©×œ×•×—×™ ×× ×•×ª ×˜×¢×™××™× ×•××•×•×™×¨×” ×©×œ ×”×ª×—×“×©×•×ª. ×‘×•××• × ×—×’×•×’ ×™×—×“ ××ª ×©××—×ª ×”×—×™×™× ×•××ª ×›×•×—×” ×©×œ ×”××—×“×•×ª.', en: 'Happy Purim to the whole family! May you have a holiday full of joy, creative costumes, delicious mishloach manot, and a spirit of renewal. Let\'s celebrate the joy of life and the power of unity together.' }, startDate: new Date('2026-03-14T00:00:00'), endDate: new Date('2026-03-15T23:59:59')},
      { id: 'passover', name: { he: '×¤×¡×—', en: 'Passover' }, message: { he: 'ğŸ· ×—×’ ×¤×¡×— ×©××—!', en: 'ğŸ· Happy Passover!' }, detailed_message: { he: '×—×’ ×¤×¡×— ×›×©×¨ ×•×©××— ×œ×›×œ ×”××©×¤×—×”! ×× ×• ×××—×œ×™× ×œ×›× ×—×’ ×©×œ ×—×™×¨×•×ª, ×©×œ ×¡×™×¤×•×¨×™× ××”×”×’×“×” ×•×©×œ ××¨×•×—×•×ª ××©×¤×—×ª×™×•×ª ×‘×œ×ª×™ × ×©×›×—×•×ª. ××™ ×™×™×ª×Ÿ ×•×ª×–×›×• ×œ×™×”× ×•×ª ××›×œ ×¨×’×¢ ×™×—×“.', en: 'A kosher and happy Passover to the entire family! We wish you a holiday of freedom, stories from the Haggadah, and unforgettable family meals. May you enjoy every moment together.' }, startDate: new Date('2026-04-02T00:00:00'), endDate: new Date('2026-04-10T23:59:59')},
      { id: 'israeliIndependenceDay', name: { he: '×™×•× ×”×¢×¦×××•×ª', en: 'Israeli Independence Day' }, message: { he: 'ğŸ‡®ğŸ‡± ×™×•× ×”×¢×¦×××•×ª ×©××—!', en: 'ğŸ‡®ğŸ‡± Happy Independence Day!' }, detailed_message: { he: '×™×•× ×”×¢×¦×××•×ª ×©××—! ×–×”×• ×™×•× ×©×œ ×—×’×™×’×”, ×©×œ ×’××•×•×” ×•×©×œ ×”×•×§×¨×” ×œ××“×™× ×” ×©×œ× ×•. ×‘×•××• × ×–×›×•×¨ ××ª ×›×œ ××™ ×©×”×§×¨×™×‘ ×œ××¢× ×” ×•× ××©×™×š ×œ×‘× ×•×ª ×™×—×“ ×¢×ª×™×“ ×˜×•×‘ ×™×•×ª×¨.', en: 'Happy Independence Day! This is a day of celebration, pride, and appreciation for our country. Let\'s remember all those who sacrificed for it and continue to build a better future together.' }, startDate: new Date('2026-05-02T00:00:00'), endDate: new Date('2026-05-03T23:59:59')},
      { id: 'lagBaOmer', name: { he: '×œ"×’ ×‘×¢×•××¨', en: 'Lag BaOmer' }, message: { he: 'ğŸ”¥ ×œ"×’ ×‘×¢×•××¨ ×©××—!', en: 'ğŸ”¥ Happy Lag BaOmer!' }, detailed_message: { he: '×—×’ ×œ"×’ ×‘×¢×•××¨ ×©××—! ×–×”×• ×–××Ÿ ×©×œ ×”×ª×—×“×©×•×ª ×•×©×œ ×©××—×”, ×©×œ ×”×“×œ×§×ª ××“×•×¨×•×ª ××©×•×ª×¤×•×ª ×•×©×œ ×©×™×¨×™×. ×× ×• ×××—×œ×™× ×œ×›× ×—×’ ××œ× ×‘××•×¨ ×•×—×•×, ×•×©×”×©× ×” ×ª×”×™×” ××•××¨×ª ×•×¤×•×¨×™×™×” ×¢×‘×•×¨ ×›×•×œ× ×•.', en: 'Happy Lag BaOmer! This is a time of renewal and joy, of shared bonfires and songs. We wish you a holiday full of light and warmth, and that the year will be bright and fruitful for us all.' }, startDate: new Date('2026-05-23T00:00:00'), endDate: new Date('2026-05-24T23:59:59')},
      { id: 'shavuot', name: { he: '×©×‘×•×¢×•×ª', en: 'Shavuot' }, message: { he: 'ğŸ§€ ×—×’ ×©×‘×•×¢×•×ª ×©××—!', en: 'ğŸ§€ Happy Shavuot!' }, detailed_message: { he: '×—×’ ×©×‘×•×¢×•×ª ×©××— ×•××œ× ×‘×’×‘×™× ×•×ª! ×× ×• ×××—×œ×™× ×œ×›× ×—×’ ×©×œ ×œ×™××•×“, ×©×œ ×§×‘×œ×ª ×”×ª×•×¨×” ×•×©×œ ××¨×•×—×•×ª ×—×œ×‘×™×•×ª ×˜×¢×™××•×ª. ××™ ×™×™×ª×Ÿ ×•×ª×–×›×• ×œ×™×”× ×•×ª ××›×œ ×¨×’×¢ ×¢× ×‘× ×™ ×”××©×¤×—×”.', en: 'Happy and cheese-filled Shavuot! We wish you a holiday of learning, receiving the Torah, and delicious dairy meals. May you enjoy every moment with your family.' }, startDate: new Date('2026-06-21T00:00:00'), endDate: new Date('2026-06-22T23:59:59')},
      { id: 'tishaBAv', name: { he: '×˜×³ ×‘××‘', en: 'Tisha B\'Av' }, message: { he: 'ğŸ˜” ×¦×•× ×§×œ', en: 'ğŸ˜” Easy Fast' }, detailed_message: { he: '×¦×•× ×§×œ ×•×’××¨ ×—×ª×™××” ×˜×•×‘×”. ×™×•× ×–×” ×”×•× ×™×•× ×©×œ ××‘×œ ×¢×œ ×—×•×¨×‘×Ÿ ×‘×™×ª ×”××§×“×©. ×× ×• ×–×•×›×¨×™× ×•××§×•×•×™× ×œ×™××™× ×˜×•×‘×™× ×™×•×ª×¨.', en: 'An easy fast and a good final signing. This day is a day of mourning for the destruction of the Temple. We remember and hope for better days.' }, startDate: new Date('2026-07-23T00:00:00'), endDate: new Date('2026-07-24T23:59:59')}
    ];

    // ----------------------------------------------------
    // 4. ×¤×•× ×§×¦×™×•×ª ×©××™×¨×” ×•×˜×¢×™× ×” ×-Firestore
    // ----------------------------------------------------

    /**
     * ××—×–×™×¨×” ××ª ×”× ×ª×™×‘ ×œ××¡××š ×”-Firestore ×”×¦×™×‘×•×¨×™ ×©×œ ×”×¢×œ×•×Ÿ.
     * @returns {object} DocRef
     */
    function getNewsletterDocRef() {
        if (!db) return null;
        // × ×ª×™×‘ ×¦×™×‘×•×¨×™ ×œ××¤×œ×™×§×¦×™×”: /artifacts/{appId}/public/data/newsletter/content
        return doc(db, 'artifacts', appId, 'public', 'data', 'newsletter', 'content');
    }

    /**
     * ×˜×•×¢× ×ª × ×ª×•× ×™× ×-Firestore ×•×××–×™× ×” ×œ×¢×“×›×•× ×™× ×‘×–××Ÿ ×××ª.
     */
    function loadContentFromFirestore() {
        if (!isAuthReady || !db) return;

        const docRef = getNewsletterDocRef();
        if (!docRef) return;
        
        loadingStatus.textContent = defaultContent[currentLang].loadingStatus;

        if (unsubscribe) {
            unsubscribe();
        }

        unsubscribe = onSnapshot(docRef, (docSnap) => {
            if (docSnap.exists()) {
                // ×¢×“×›×•×Ÿ ×”× ×ª×•× ×™× ×”×—×™×™× ×-Firestore
                const data = docSnap.data();
                console.log("Firestore data received:", data);
                if (data.he && data.en) {
                    // ×¢×“×›×•×Ÿ ×”×ª×•×›×Ÿ ×”×¨××©×™ ×ª×•×š ×©××™×¨×” ×¢×œ × ×ª×•× ×™ ×‘×¨×™×¨×ª ×”××—×“×œ ×œ××§×¨×” ×©×—×¡×¨ ××©×”×•
                    newsletterData.he = { ...defaultContent.he, ...data.he };
                    newsletterData.en = { ...defaultContent.en, ...data.en };
                } else {
                    console.warn("Firestore document found, but structure is missing 'he' or 'en'. Using default content.");
                }
            } else {
                console.log("No initial newsletter data found in Firestore. Saving default content.");
                // ×× ××™×Ÿ × ×ª×•× ×™×, ×©××•×¨ ××ª × ×ª×•× ×™ ×‘×¨×™×¨×ª ×”××—×“×œ
                saveContentToFirestore(defaultContent);
            }
            // ×¢×“×›×•×Ÿ ×”×××©×§ ×¢× ×”× ×ª×•× ×™× ×”×—×“×©×™×/×‘×¨×™×¨×ª ×”××—×“×œ
            updateLanguage();
            loadingStatus.textContent = defaultContent[currentLang].loadedStatus;
        }, (error) => {
            console.error("Error listening to Firestore:", error);
            loadingStatus.textContent = `Error: ${error.message}`;
            showMessage('×©×’×™××”', `×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×: ${error.message}`);
        });
        isFirestoreReady = true;
    }

    /**
     * ×©×•××¨ ××ª ×”×ª×•×›×Ÿ ×”× ×•×›×—×™ ×©×œ ×”×¢×œ×•×Ÿ ×œ-Firestore.
     * @param {object} [dataToSave=newsletterData] - ×”× ×ª×•× ×™× ×œ×©××™×¨×”. ×× ×œ× ×¡×•×¤×§, ×™×©××•×¨ ××ª ×”××¦×‘ ×”× ×•×›×—×™.
     */
    async function saveContentToFirestore(dataToSave = newsletterData) {
        if (!isAdminMode || !db) {
            console.warn("Save attempted, but not in Admin Mode or Firestore not initialized.");
            return;
        }

        const docRef = getNewsletterDocRef();
        if (!docRef) return;

        // ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×”×©××™×¨×”
        adminIndicator.textContent = defaultContent[currentLang].savingStatus;
        adminIndicator.classList.add('bg-yellow-500');
        adminIndicator.classList.remove('bg-red-600');

        try {
            await setDoc(docRef, {
                he: dataToSave.he,
                en: dataToSave.en,
                lastUpdated: serverTimestamp(),
                userId: userId // ××™ ×©×©××¨ ××—×¨×•×Ÿ
            }, { merge: true });

            console.log("Document successfully written!");
            // ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×”×©××™×¨×” ×œ×”×¦×œ×—×”
            adminIndicator.textContent = defaultContent[currentLang].savedStatus;
            adminIndicator.classList.add('bg-green-500');
            adminIndicator.classList.remove('bg-yellow-500');
            setTimeout(() => {
                adminIndicator.textContent = defaultContent[currentLang].adminIndicator;
                adminIndicator.classList.remove('bg-green-500');
                adminIndicator.classList.add('bg-red-600');
            }, 2000);

        } catch (e) {
            console.error("Error writing document: ", e);
            adminIndicator.textContent = `×©×’×™××ª ×©××™×¨×”: ${e.code}`;
            adminIndicator.classList.add('bg-red-600');
            adminIndicator.classList.remove('bg-yellow-500');
        }
    }

    /**
     * ×¤×•× ×§×¦×™×™×ª ×©××™×¨×” ×›×œ×œ×™×ª ×”××¢×“×›× ×ª ××ª ×”-JS ×•××¤×¢×™×œ×” ×©××™×¨×” ×œ-Firestore.
     * @param {HTMLElement} element - ×”××œ×× ×˜ ×©×¢×‘×¨ ×¢×¨×™×›×”.
     */
    function handleContentUpdate(element) {
        if (!isAdminMode) return;

        const key = element.id;
        const langKey = currentLang;

        // ×× ×”××œ×× ×˜ ×”×•× ×—×œ×§ ××”×¨×©×™××”
        if (element.parentElement.id === 'eventsList') {
            // ×¢×‘×•×¨ ×¨×©×™××•×ª, ×©××•×¨ ××ª ×”-innerHTML ×”××œ× ×©×œ ×”×¨×©×™××”
            const listContent = element.parentElement.innerHTML;
            newsletterData[langKey]['eventsList'] = listContent;
        } else {
            // ×¢×‘×•×¨ ××œ×× ×˜×™× ×¨×’×™×œ×™×, ×©××•×¨ ××ª ×”-innerHTML
            newsletterData[langKey][key] = element.innerHTML;
        }

        // ×”×¤×¢×œ×ª ×©××™×¨×” ×œ-Firestore
        saveContentToFirestore();
    }

    // ----------------------------------------------------
    // 5. ×œ×•×’×™×§×ª ×”×××©×§ (UI)
    // ----------------------------------------------------

    /**
     * ××¢×“×›× ×ª ××ª ×ª×¦×•×’×ª ×”×—×’ ×”× ×•×›×—×™×ª.
     */
    function updateHolidaySection() {
      const holidaySection = document.getElementById('holidaySection');
      const holidayTitle = document.getElementById('holidayTitle');
      const holidayText = document.getElementById('holidayText');
      let currentHoliday = null;

      for (const holiday of holidays) {
        if (now >= holiday.startDate && now <= holiday.endDate) {
          currentHoliday = holiday;
          break;
        }
      }

      const langData = newsletterData[currentLang]; // Use live data for strings
      
      if (currentHoliday) {
        holidayTitle.innerHTML = currentHoliday.message[currentLang];
        holidayText.textContent = currentHoliday.detailed_message[currentLang];
        holidaySection.style.display = 'block';
      } else {
        holidaySection.style.display = 'none';
      }
    }

    /**
     * ××¢×“×›× ×ª ××ª ×›×œ ×”×˜×§×¡×˜×™× ×‘×”×ª×× ×œ×©×¤×” ×”× ×•×›×—×™×ª ×•×œ× ×ª×•× ×™× ×”×—×™×™×.
     */
    function updateLanguage() {
      const langData = newsletterData[currentLang];
      const defaultLangData = defaultContent[currentLang];

      document.documentElement.lang = currentLang;
      document.documentElement.dir = currentLang === 'he' ? 'rtl' : 'ltr';

      // ×¢×“×›×•×Ÿ ×›×œ ×”××œ×× ×˜×™×
      for (const key in elementsToTranslate) {
          const element = elementsToTranslate[key];
          if (element) {
              // ×§×‘×œ×ª ×”×ª×•×›×Ÿ ××”× ×ª×•× ×™× ×”×—×™×™× (××• ×‘×¨×™×¨×ª ××—×“×œ ×× ×—×¡×¨)
              const content = langData[key] || defaultContent[currentLang][key] || defaultContent['he'][key] || defaultContent['en'][key];
              
              if (key === 'eventsList' || key.includes('recommendation')) {
                  element.innerHTML = content;
              } else if (key !== 'lang-text') {
                  element.textContent = content;
              }
          }
      }
      
      // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨ ×”×©×¤×” ×•×¡×˜×˜×•×¡
      elementsToTranslate['lang-text'].textContent = defaultContent[currentLang].buttonText;
      loadingStatus.textContent = isFirestoreReady ? defaultLangData.loadedStatus : defaultLangData.loadingStatus;
      
      // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨ ×× ×”×œ
      if (isAdminMode) {
          adminButtonText.textContent = langData.adminLogoutText;
          adminToggleBtn.title = '×™×¦×™××” ××× ×”×œ';
          adminToggleBtn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
          adminToggleBtn.classList.add('bg-red-600', 'text-white', 'hover:bg-red-700');
      } else {
          adminButtonText.textContent = langData.adminLoginText;
          adminToggleBtn.title = '×›× ×™×¡×ª ×× ×”×œ';
          adminToggleBtn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
          adminToggleBtn.classList.remove('bg-red-600', 'text-white', 'hover:bg-red-700');
      }

      // ×¢×“×›×•×Ÿ ×ª×¦×•×’×ª ×”×—×’
      updateHolidaySection();
      
      // ×”×—×œ×ª ××¦×‘ ×¢×¨×™×›×” ××—×“×© (×× × ×“×¨×©)
      if (isAdminMode) {
          toggleEditMode(true);
      } else {
          toggleEditMode(false);
      }
    }
    
    document.getElementById('lang-toggle').addEventListener('click', () => {
      currentLang = currentLang === 'he' ? 'en' : 'he';
      updateLanguage();
    });
    
    // --- Modal Logic ---

    function showModal(modalId) {
      document.getElementById('modalOverlay').style.display = 'flex';
      document.getElementById(modalId).style.display = 'block';
      document.getElementById(modalId).classList.add('scale-100');
      document.getElementById(modalId).classList.remove('scale-95');
    }

    function hideModal(modalId) {
      document.getElementById(modalId).classList.add('scale-95');
      document.getElementById(modalId).classList.remove('scale-100');
      setTimeout(() => {
        document.getElementById(modalId).style.display = 'none';
        document.getElementById('modalOverlay').style.display = 'none';
      }, 300); // Match transition duration
    }

    function showMessage(title, content) {
      document.getElementById('messageTitle').textContent = title;
      document.getElementById('messageContent').textContent = content;
      showModal('messageModal');
    }

    // --- Admin/Edit Mode Logic ---

    function toggleEditMode(isEnabled) {
        isAdminMode = isEnabled;
        const editableKeys = Object.keys(elementsToTranslate).filter(key => key !== 'lang-text'); 
        const langData = defaultContent[currentLang];

        // 1. ×”×’×“×¨×ª ×¢×¨×™×›×” ×•×”×•×¡×¤×ª ×××–×™× ×™×
        editableKeys.forEach(key => {
            const element = elementsToTranslate[key];
            if (!element) return;

            // ×”×¡×¨×ª ×××–×™× ×™ ×©××™×¨×” ×§×•×“××™× ×›×“×™ ×œ×× ×•×¢ ×›×¤×™×œ×•×™×•×ª
            element.onblur = null;

            if (key === 'eventsList') {
                // ×˜×™×¤×•×œ ××™×•×—×“ ×‘×¨×©×™××ª ××™×¨×•×¢×™× (UL) - ×”×¤×™×›×ª ×”×™×œ×“×™× ×œ×¢×¨×™×›×™×
                Array.from(element.children).forEach(child => {
                    child.contentEditable = isEnabled ? 'true' : 'false';
                    child.onblur = isEnabled ? () => handleContentUpdate(element) : null;
                });
            } else {
                // ×˜×™×¤×•×œ ×‘××œ×× ×˜×™× ×¨×’×™×œ×™×
                element.contentEditable = isEnabled ? 'true' : 'false';
                element.onblur = isEnabled ? () => handleContentUpdate(element) : null;
            }
        });

        // 2. ×•×™×–×•××œ×™×–×¦×™×” ×©×œ ××¦×‘ ×× ×”×œ ×•×”×’×“×¨×ª ×›×¤×ª×•×¨
        if (isEnabled) {
            adminIndicator.classList.remove('hidden');
            adminIndicator.classList.add('bg-red-600');
            adminIndicator.textContent = langData.adminIndicator;
        } else {
            adminIndicator.classList.add('hidden');
        }
        
        // ×¢×“×›×•×Ÿ ××¦×‘ ×”×›×¤×ª×•×¨
        updateLanguage();
    }
    
    /**
     * ×¤×•× ×§×¦×™×” ×œ×”×ª× ×ª×§×•×ª ×××¦×‘ ×× ×”×œ.
     */
    function logoutAdmin() {
        if (!isAdminMode) return;
        const langData = defaultContent[currentLang];

        // 1. ×‘×™×˜×•×œ ××¦×‘ ×¢×¨×™×›×”
        toggleEditMode(false);
        
        // 2. ×¢×“×›×•×Ÿ ××¦×‘ ×’×œ×•×‘×œ×™
        isAdminMode = false;
        
        // 3. ×”×¦×’×ª ×”×•×“×¢×”
        showMessage('×™×¦×™××”', langData.logoutSuccess);
    }
    
    // --- Admin Button Event Listener ---
    document.getElementById('adminToggleBtn').addEventListener('click', () => {
        if (isAdminMode) {
            // ×× ×›×‘×¨ ×× ×”×œ, ×œ×—×™×¦×” ××©××¢×•×ª×” ×™×¦×™××”
            logoutAdmin();
        } else {
            // ×× ×œ× ×× ×”×œ, ×œ×—×™×¦×” ××©××¢×•×ª×” ×”×¦×’×ª ×—×œ×•×Ÿ ×›× ×™×¡×”
            showModal('passwordModal');
            document.getElementById('adminPasswordInput').value = '';
        }
    });

    // --- Submit Password Listener ---
    document.getElementById('submitPasswordBtn').addEventListener('click', () => {
      const input = document.getElementById('adminPasswordInput').value;
      const langData = defaultContent[currentLang];

      hideModal('passwordModal');
      
      if (input === ADMIN_PASSWORD) {
        isAdminMode = true; // Set state first
        toggleEditMode(true); // Apply editing and UI changes
        showMessage('×”×ª×—×‘×¨×•×ª ×”×¦×œ×™×—×”', langData.loginSuccess);
      } else {
        toggleEditMode(false); 
        showMessage('×©×’×™××”', langData.loginError);
      }
    });


    // Event Listeners for Modals
    document.getElementById('closePasswordModalBtn').addEventListener('click', () => {
      hideModal('passwordModal');
    });
    
    document.getElementById('closeMessageModalBtn').addEventListener('click', () => {
      hideModal('messageModal');
    });

    // ----------------------------------------------------
    // 6. ××ª×—×•×œ Firebase ×•×”×ª×—×‘×¨×•×ª
    // ----------------------------------------------------
    
    function initializeFirebaseAndAuth() {
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            document.getElementById('userIdDisplay').textContent = `App ID: ${appId}`;
        } catch (error) {
            console.error("Firebase Initialization Error:", error);
            showMessage('×©×’×™××ª ××ª×—×•×œ', '×œ× × ×™×ª×Ÿ ×œ×”×ª×—×‘×¨ ×œ-Firebase.');
            return;
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                document.getElementById('userIdDisplay').textContent += ` | User ID: ${userId}`;
                isAuthReady = true;
                loadContentFromFirestore(); // ×˜×¢×Ÿ × ×ª×•× ×™× ×œ××—×¨ ×”××™××•×ª
            } else {
                // ×× ××™×Ÿ ××©×ª××©, × ×¡×” ×œ×”×™×›× ×¡ ×›×× ×•× ×™××™ ×× ××™×Ÿ ××¡×™××•×Ÿ
                if (!initialAuthToken) {
                    try {
                        await signInAnonymously(auth);
                    } catch (e) {
                        console.error("Anonymous Sign-In Error:", e);
                        showMessage('×©×’×™××ª ××™××•×ª', '×œ× × ×™×ª×Ÿ ×œ×”×™×›× ×¡ ×× ×•× ×™××™×ª. ×”×¤×•× ×§×¦×™×•× ×œ×™×•×ª ××•×’×‘×œ×ª.');
                        isAuthReady = true; // × ××©×™×š ×œ×˜×¢×•×Ÿ ×’× ×× × ×›×©×œ
                        loadContentFromFirestore();
                    }
                } else {
                     // ×× ×™×© ××¡×™××•×Ÿ, ×”×•× ×™×™×˜×¢×Ÿ ××•×˜×•××˜×™×ª ×¢"×™ onAuthStateChanged ×‘×“×¨×š ×›×œ×œ
                     isAuthReady = true;
                     loadContentFromFirestore();
                }
            }
        });
        
        // ×›× ×™×¡×” ×‘×××¦×¢×•×ª ××¡×™××•×Ÿ ××•×ª×× ××™×©×™×ª ×× ×§×™×™×
        if (initialAuthToken && !auth.currentUser) {
             signInWithCustomToken(auth, initialAuthToken).catch(error => {
                console.error("Custom Token Sign-In Error:", error);
                // ×× ×”×›× ×™×¡×” ×¢× ×”××¡×™××•×Ÿ × ×›×©×œ×ª, × ×¡×” ×›× ×™×¡×” ×× ×•× ×™××™×ª ×›×’×™×‘×•×™
                signInAnonymously(auth).catch(e => {
                    console.error("Fallback Anonymous Sign-In Error:", e);
                });
             });
        }
    }

    // ×”×¤×¢×œ×ª ×”××ª×—×•×œ
    initializeFirebaseAndAuth();

  </script>

</body>
</html>
