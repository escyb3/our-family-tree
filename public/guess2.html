<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>כלי ליצירת לוגו עץ משפחה</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            direction: rtl;
            text-align: right;
        }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';

        const App = () => {
            const [imageUrl, setImageUrl] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');

            // פונקציה ליצירת תמונה באמצעות ה-API של Gemini
            const generateImage = async () => {
                setIsLoading(true);
                setError('');
                setImageUrl('');

                // הפרומפט מאוד ספציפי ומשתמש במספר ביטויים כדי לשלול בתוקף טקסט.
                const prompt = "An artistic and elegant family tree logo, flowing lines, abstract and organic shapes, subtle color gradient, high resolution vector art. The image must be completely devoid of any text, words, lettering, or typography of any kind. This is a purely visual logo, with no writing.";
                
                const maxRetries = 3;
                let retries = 0;
                const initialDelay = 1000;

                while (retries < maxRetries) {
                    try {
                        const payload = { 
                            instances: [{ prompt: prompt }], 
                            parameters: { "sampleCount": 1 } 
                        };
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
                        
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            const result = await response.json();
                            const base64Data = result?.predictions?.[0]?.bytesBase64Encoded;
                            if (base64Data) {
                                setImageUrl(`data:image/png;base64,${base64Data}`);
                                setIsLoading(false);
                                return;
                            } else {
                                throw new Error('API response was missing image data.');
                            }
                        } else {
                            const errorText = await response.text();
                            console.error(`API Error: ${response.status} - ${errorText}`);
                            throw new Error(`API Error: ${response.status}`);
                        }
                    } catch (err) {
                        console.error('Error fetching image from API:', err);
                        retries++;
                        const delay = initialDelay * Math.pow(2, retries - 1);
                        await new Promise(res => setTimeout(res, delay));
                    }
                }
                
                setIsLoading(false);
                setError('שגיאה ביצירת התמונה. נסה שוב.');
            };

            // יוצר תמונה ראשונית כשהקומפוננטה נטענת
            useEffect(() => {
                generateImage();
            }, []);

            return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4 font-sans">
                    <div className="bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl text-center">
                        <h1 className="text-3xl font-extrabold text-gray-800 mb-4">כלי ליצירת לוגו עץ משפחה</h1>
                        <p className="text-gray-600 mb-6">
                            לחץ על הכפתור כדי ליצור לוגו חדש עד שתמצא את העיצוב המושלם ללא כיתוב.
                        </p>

                        <div className="flex justify-center items-center h-96 w-full bg-gray-200 rounded-lg overflow-hidden mb-6 relative">
                            {isLoading ? (
                                <div className="flex flex-col items-center justify-center">
                                    <svg className="animate-spin h-8 w-8 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <p className="mt-2 text-gray-500">טוען...</p>
                                </div>
                            ) : imageUrl ? (
                                <img src={imageUrl} alt="Generated artistic family tree logo without text" className="w-full h-full object-contain rounded-lg" />
                            ) : (
                                <p className="text-red-500">{error || 'לחץ על הכפתור כדי ליצור לוגו חדש.'}</p>
                            )}
                        </div>

                        <button 
                            onClick={generateImage} 
                            className="w-full bg-blue-500 text-white py-3 px-6 rounded-full font-bold text-lg hover:bg-blue-600 transition-colors shadow-lg disabled:bg-gray-400"
                            disabled={isLoading}
                        >
                            {isLoading ? 'יוצר...' : 'צור לוגו חדש'}
                        </button>
                    </div>
                </div>
            );
        };

        // Mount the app to the DOM
        window.onload = () => {
            const container = document.getElementById('root');
            if (container) {
                const root = createRoot(container);
                root.render(<App />);
            }
        };
    </script>
</body>
</html>
